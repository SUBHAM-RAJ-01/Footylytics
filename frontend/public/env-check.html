<!DOCTYPE html>
<html>
<head>
    <title>Environment Check - Footylytics</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Footylytics Environment Check</h1>
    <p>This page checks if environment variables are properly loaded in production.</p>
    
    <div id="results">
        <p>Loading...</p>
    </div>

    <script type="module">
        const results = document.getElementById('results');
        
        // Check environment variables
        const envVars = {
            'VITE_API_URL': import.meta.env.VITE_API_URL,
            'VITE_SUPABASE_URL': import.meta.env.VITE_SUPABASE_URL,
            'VITE_SUPABASE_ANON_KEY': import.meta.env.VITE_SUPABASE_ANON_KEY,
            'VITE_STRIPE_PUBLIC_KEY': import.meta.env.VITE_STRIPE_PUBLIC_KEY,
            'VITE_STRIPE_PRICE_ID_MONTHLY': import.meta.env.VITE_STRIPE_PRICE_ID_MONTHLY,
            'VITE_STRIPE_PRICE_ID_YEARLY': import.meta.env.VITE_STRIPE_PRICE_ID_YEARLY,
            'VITE_APP_URL': import.meta.env.VITE_APP_URL,
            'MODE': import.meta.env.MODE
        };

        let html = '<h2>Environment Variables Status:</h2>';
        
        Object.entries(envVars).forEach(([key, value]) => {
            const hasValue = value && value !== 'undefined';
            const statusClass = hasValue ? 'success' : 'error';
            const statusText = hasValue ? '‚úÖ Set' : '‚ùå Missing';
            const displayValue = hasValue ? (key.includes('KEY') ? 'pk_***...' : value) : 'Not set';
            
            html += `
                <div class="status ${statusClass}">
                    <strong>${key}:</strong> ${statusText} 
                    <br><small>${displayValue}</small>
                </div>
            `;
        });

        // Test API connection
        html += '<h2>API Connection Test:</h2>';
        
        const apiUrl = envVars.VITE_API_URL || 'https://footylytics.onrender.com/api';
        
        fetch(`${apiUrl}/health`)
            .then(response => response.json())
            .then(data => {
                html += `<div class="status success">‚úÖ Backend API: Connected<br><small>${JSON.stringify(data)}</small></div>`;
                results.innerHTML = html;
            })
            .catch(error => {
                html += `<div class="status error">‚ùå Backend API: Failed<br><small>${error.message}</small></div>`;
                results.innerHTML = html;
            });

        // Initial render without API test
        results.innerHTML = html + '<div class="status warning">üîÑ Testing API connection...</div>';

        // Instructions
        html += `
            <h2>üìã Fix Instructions:</h2>
            <div class="status warning">
                <strong>If variables are missing:</strong><br>
                1. Go to Netlify Dashboard ‚Üí Site Settings ‚Üí Environment Variables<br>
                2. Add the missing variables from your .env file<br>
                3. Redeploy the site<br><br>
                <strong>Variables needed:</strong><br>
                <pre>VITE_API_URL=https://footylytics.onrender.com/api
VITE_SUPABASE_URL=https://hahlmozurgvywogzauli.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
VITE_STRIPE_PUBLIC_KEY=pk_test_51RON2JFy9kI1RIxk...
VITE_STRIPE_PRICE_ID_MONTHLY=price_1SDwHmFy9kI1RIxkIsRfoJ8I
VITE_STRIPE_PRICE_ID_YEARLY=price_1SDwIRFy9kI1RIxkNrnKadP8
VITE_APP_URL=https://footylytics.netlify.app</pre>
            </div>
        `;
    </script>
</body>
</html>